
### Launching methyl-seek pipeline 

##### 1. Download methyl-seek repository from github: https://github.com/OpenOmics/RNA-seek/archive/refs/heads/main.zip
```
mkdir ~/project
cd ~/project

wget https://github.com/OpenOmics/RNA-seek/archive/refs/heads/main.zip
unzip main.zip
cd methyl-seek-main
```

##### 2. Input FASTQ file names should be formatted as below: 
```
sample1.R1.fastq.gz
sample1.R2.fastq.gz
sample2.R1.fastq.gz
sample2.R2.fastq.gz
sample3.R1.fastq.gz
sample3.R2.fastq.gz
sample4.R1.fastq.gz
sample4.R2.fastq.gz
sample6.R1.fastq.gz
sample6.R2.fastq.gz
sample7.R1.fastq.gz
sample7.R2.fastq.gz
sample8.R1.fastq.gz
sample8.R2.fastq.gz
```

##### 3. Edit ```config.yaml``` as below:
   - Set ```rawdata_dir``` to the absolute path of the directory containing all your fastqs. In this example, there are located in ```~/project/fastq/```
   - Set ```result_dir``` to the absolute path of the working directory containing methyl-seek pipeline. This directory will also store result files generated by methyl-seek pipeline.
   - Set ```samples``` to be the absolute path of your ```samples.txt``` located within ```result_dir```. 
   
```
samples: "~/project/methyl-seek-main/samples.txt"
rawdata_dir: "~/project/fastq/"
result_dir: "~/project/methyl-seek-main/"
```

##### 4. Create tab-delimited, three-column formatted ```samples.txt``` with header as shown below: 

```
sample  group comp
sample1  GA  GAvsGB
sample2  GA  GAvsGB
sample3  GB  GAvsGB
sample4  GB  GAvsGB
sample5  GC  GAvsGC
sample6  GC  GAvsGC
sample7  GA  GAvsGC
sample8  GA  GAvsGC
```
where GA, GB, & GC are sample groups that should be compared.

##### 5. Creating bisulphite marked reference genome:
Human hg38 genome is default reference. Bisulphite marked hg38 reference is available with the repository. To create bisulphite marked reference for your own genome of interest ```mm10.genome.fa```:

```
module load bismark/0.23.0
mkdir ~/project/bisulphite_genome
cd ~/project/bisulphite_genome
cp mm10.genome.fa ~/project/bisulphite_genome/
bismark_genome_preparation --verbose --parallel 4 ~/project/bisulphite_genome 
```

Also, edit ```config.yaml``` as below:

```
bisulphite_ref: "~/project/bisulphite_genome"
bisulphite_fa: "~/project/bisulphite_genome/mm10.genome.fa"
species: "mm10"
```
 
##### 6. Running snakemake
  - To unlock the working directory:
  ``` 
  cd ~/project/methyl-seek-main/
  snakemake --unlock -j 1 --configfile ./config.yaml
  ```
  
  - To execute dry-run:
  ``` 
  cd ~/project/methyl-seek-main/
  sbatch pipeline_submit.sh npr ./
  ```
   OR
  ```
  cd ~/project/methyl-seek-main/
  snakemake -npr --snakefile $R/Snakefile -j 1 --configfile ./config.yaml
  ```
  
  - To launch pipeline:
  ``` 
  cd ~/project/methyl-seek-main/
  sbatch pipeline_submit.sh process ./
  ```
  

### Methyl-seek pipeline 

#### 1. Quality Control and Summary Statistics
- FastQC is used to assess the sequencing quality. FastQC is run twice, before and after adapter trimming. It generates a set of basic statistics to identify problems that can arise during sequencing or library preparation. FastQC will summarize per base and per read QC metrics such as quality scores and GC content. It will also summarize the distribution of sequence lengths and will report the presence of adapter sequences.

- TrimGalor
{is used to remove adapter sequences, perform quality trimming, and remove very short sequences that would otherwise multi-map all over the genome prior to alignment.}

- Kraken2 and FastQ Screen are used to screen for various sources of contamination. During the process of sample collection to library preparation, there is a risk for introducing wanted sources of DNA. FastQ Screen compares your sequencing data to a set of different reference genomes to determine if there is contamination. It allows a user to see if the composition of your library matches what you expect. Also, if there are high levels of microbial contamination, Kraken can provide an estimation of the taxonomic composition. Kraken can be used in conjunction with Krona to produce interactive reports.

- BBmerge

- MultiQC is used to aggreate the results of each tool into a single interactive report.

#### 2. Determine cytosine methylation  
 - Bismark is used to map bisulfite treated sequencing reads to bisulphite marked reference genome of interest ``` default: human hg38 genome```` and perform cytosine methylation calls in CpG, CHG and CHH context.
 
#### 3. Deconvolution of cfDNA 
 - bsseq (R package) is used for 

 * dcv - which uses the previously generated CpG to deconvolute the data and identify which tissues samples belong to based on methylation profiles
 
#### 4. Differential methylation calls

 * dmr - which uses the previously generated CpG profiles to identify differentially methylated regions between groups.


